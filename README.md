# æ°‘ç”Ÿæ•¸ä½æœå‹™éŸŒæ€§æª¢æ¸¬

###### tags: digital-resilience, æ•¸ä½éŸŒæ€§æ¾, DigiResiTh0n

> [License under CC0, No Rights Reserved](https://creativecommons.org/public-domain/cc0/)
> 
> [![Colloborate on HackMD](badge.svg)](https://g0v.hackmd.io/@irvin/digital-services-resilience)
> 
> [github archive](https://github.com/irvin/digital-service-resilience)

```
åœ¨å¤©ç½äººç¦å°è‡´ã€Œå°ç£å°å¤–æ–·ç¶²ã€æ™‚ï¼Œå¸Œæœ›èƒ½ç›¡é‡ç¶­æŒæ­£å¸¸é‹ä½œçš„é‡è¦ç¶²è·¯æœå‹™ã€‚
```

---

**æƒ…å¢ƒï¼š** 2023å¹´åˆï¼Œé¦¬ç¥–çš„å°å¤–æµ·çºœè¢«ä¸­åœ‹çš„æ‹–ç¶²æ¼èˆ¹/æŒ–æ²™èˆ¹ã€Œæ„å¤–ã€æŒ–æ–·ï¼Œå› è€Œæ–·ç¶²é•·é”æ•¸å€‹æœˆã€‚å‡è¨­æ­¤ä¸€æƒ…å¢ƒç™¼ç”Ÿåœ¨å°ç£ï¼Œå°ç£å°å¤–ç¶²è·¯éª¨å¹¹æµ·çºœæ–·äº†å…«ä¹æˆï¼ˆç”šè‡³å®Œå…¨ä¸­æ–·ï¼‰ï¼Œæœ‰å“ªäº›æœå‹™ï¼Œæ˜¯ç¶­æŒ*åŸºæœ¬ç”Ÿæ´»å“è³ª*å¿…è¦çš„æœå‹™ï¼Œæ‡‰åœ¨ã€Œåªæœ‰å³¶å…§ç¶²è·¯ã€çš„ç‹€æ…‹ä¸‹ç¶­æŒæ­£å¸¸é‹ä½œï¼Ÿ

**ç¯„ç–‡ï¼š** åœ‹æ°‘ç¬¬ä¸€ç·šæœƒä½¿ç”¨çš„ã€Œç¶²è·¯æœå‹™ã€ã€ã€Œæ‰‹æ©Ÿ APPã€ã€‚

> ä¸ç´å…¥å¯¦é«”é›¢ç·šæœå‹™å¦‚ 7-11 åº—é¢èˆ‡æ·é‹â‹¯â‹¯ç­‰ã€‚ä¹Ÿä¸åˆ—å…¥å„æ¶ˆè²»ç«¯æœå‹™çš„ä¸Šæ¸¸ç›¸é—œè¨­æ–½ï¼ˆå¦‚ EC ç¶²ç«™çš„ç‰©æµï¼Œæˆ‘å€‘æœŸå¾…è©²ç¶²ç«™èƒ½èˆ‡å…¶ä¾›æ‡‰éˆä¸Šä¸‹æ¸¸å”ä½œï¼Œæ¨è¡Œé€²ä¸€æ­¥çš„éŸŒæ€§è¨ˆç•«ï¼‰

**ç›®æ¨™ï¼š** å°åˆ—èˆ‰çš„é‡è¦æ°‘ç”Ÿæœå‹™é€²è¡Œæª¢æ¸¬ï¼Œç¢ºèªå…¶ç›¸å°å°ç£å°å¤–æ–·ç¶²æ™‚çš„éŸŒæ€§ç‹€æ…‹

**å€¡è­°ï¼š** æ°‘ç”Ÿå¿…éœ€çš„æœå‹™ï¼Œæ‡‰å‚™æœ‰å°å¤–ç¶²è·¯åš´é‡éšœç¤™çš„æ‡‰è®Šè¨ˆåŠƒï¼Œä¸¦ä¸”å®šæœŸé€²è¡Œç›¸é—œçš„æ¼”ç·´ã€‚

---

## éŸŒæ€§æª¢æ¸¬çµæœ


| æœå‹™ | æ–·ç¶²è€å—æ€§ | æª¢æ¸¬ç´€éŒ„ |
| -------- | -------- | -------- |
| Pchome 24 |  | [æ‰‹å‹•æª¢æ¸¬ç´€éŒ„](https://g0v.hackmd.io/5siiuEN1RAuFAI2H7l-phQ)
| MoMo ç”¢å“é  | ï¼¸ | [æª¢æ¸¬ç´€éŒ„](https://irvin.github.io/web-resilience-test-result/?url=https://www.momoshop.com.tw/category/LgrpCategory.jsp?l_code=2180000000)ã€[æ‰‹å‹•æª¢æ¸¬ç´€éŒ„](https://g0v.hackmd.io/9JfXRBRbSV2wE3ULGIL-XA)
| è¦çš®è³¼ç‰© |  | [æª¢æ¸¬ç´€éŒ„](https://irvin.github.io/web-resilience-test-result/?url=google.com)
| Google | ï¼¯ | [æª¢æ¸¬ç´€éŒ„](https://irvin.github.io/web-resilience-test-result/?url=google.com)
| Gmail | ï¼¯  | [æª¢æ¸¬ç´€éŒ„](https://irvin.github.io/web-resilience-test-result/?url=mail.google.com)
| Google Maps | ï¼¯  | [æª¢æ¸¬ç´€éŒ„](https://irvin.github.io/web-resilience-test-result/?url=maps.google.com)
| Yahoo Mail | ï¼¯ | [æª¢æ¸¬ç´€éŒ„](https://irvin.github.io/web-resilience-test-result/?url=mail.yahoo.com)
| Bing | ï¼¸ | [æª¢æ¸¬ç´€éŒ„](https://irvin.github.io/web-resilience-test-result/?url=www.bing.com)
| è¯è¦–æ–°èç¶² | ï¼Ÿ | [æª¢æ¸¬ç´€éŒ„](https://irvin.github.io/web-resilience-test-result/?url=https://news.cts.com.tw/cna/politics/202502/202502232440801.html)
| ä¸­å¤®ç¤¾ | ï¼¸ | [æª¢æ¸¬ç´€éŒ„](https://irvin.github.io/web-resilience-test-result/?url=https://www.cna.com.tw/news/afe/202210220159.aspx)
| å…¬è¦–æ–°è | ï¼¯ | [æª¢æ¸¬ç´€éŒ„](https://irvin.github.io/web-resilience-test-result/?url=https://news.pts.org.tw/article/739060)
| ä¸­å¤®å»£æ’­é›»å° | ï¼¸ | [æª¢æ¸¬ç´€éŒ„](https://irvin.github.io/web-resilience-test-result/?url=www.rti.org.tw)
| æ•¸ä½ç™¼å±•éƒ¨ | ï¼Ÿ | [æª¢æ¸¬ç´€éŒ„](https://irvin.github.io/web-resilience-test-result/?url=moda.gov.tw)
| åœ‹é˜²éƒ¨ | ï¼Ÿ | [æª¢æ¸¬ç´€éŒ„](https://irvin.github.io/web-resilience-test-result/?url=www.mnd.gov.tw)
| ç¸½çµ±åºœ | ï¼¯ | [æª¢æ¸¬ç´€éŒ„](https://irvin.github.io/web-resilience-test-result/?url=www.president.gov.tw)
| å…§æ”¿éƒ¨è­¦æ”¿ç½²é˜²ç©ºé¿é›£å°ˆå€ | ï¼¯ | [æª¢æ¸¬ç´€éŒ„](https://irvin.github.io/web-resilience-test-result/?url=adr.npa.gov.tw)
| g0v | ï¼¸ | [æª¢æ¸¬ç´€éŒ„](https://irvin.github.io/web-resilience-test-result/?url=g0v.tw)
| OCF | ï¼¸ | [æª¢æ¸¬ç´€éŒ„](https://irvin.github.io/web-resilience-test-result/?url=ocf.tw)
| SITCON | ï¼¸ | [æª¢æ¸¬ç´€éŒ„](https://irvin.github.io/web-resilience-test-result/?url=sitcon.org)

---

## a) é‡è¦æ•¸ä½æœå‹™

ç¤¾ç¾¤å…±åŒåˆ—èˆ‰æ°‘ç”Ÿä¸Šé‡è¦çš„æ•¸ä½æœå‹™ï¼ŒåŠåŸºç¤æ¶æ§‹ç›¸é—œæœå‹™ã€‚

-> [é‡è¦æ°‘ç”Ÿç¶²ç«™èˆ‡æ•¸ä½æœå‹™ï¼ˆèˆ‡å…¶æ›¿ä»£å“ï¼‰](http://g0v.hackmd.io/lmNxS58KQOm5Rf-H4SbvSw)


## b) æœå‹™éŸŒæ€§é—œéµå› ç´ 

- ç¶²ç«™ hosting ä¸»æ©Ÿ 
    - æ‰€åœ¨åœ° & API æ‰€åœ¨åœ°
        - ä½ç½®ï¼šåœ‹å…§ / åœ‹å¤–
        - æ˜¯å¦æ˜¯ anycastï¼Œä¸”æä¾›åœ‹å…§ç¯€é»
- ç¶²ç«™é é¢ & API æ˜¯å¦é€šé CDN
    - CDN æ˜¯å¦æ˜¯å·²çŸ¥æœ‰è½åœ°çš„å–®ä½
        - ä¾‹å¦‚ï¼šcloudflare (TPE)ã€Akamai
- ç¶²ç«™ä½¿ç”¨çš„ library (jquery, anguler, vue... etc)
    - æ˜¯å¦ä½¿ç”¨å…¬å…±çš„ CDN
        - æ˜¯å¦å·²çŸ¥æœ‰è½åœ°
        - cdnjs (over cloudflare)
        - jsdelivr?
    - æ˜¯å¦èˆ‡ç¶²ç«™ä¸€èµ· serve


## c) éŸŒæ€§æª¢æ¸¬æ­¥é©Ÿ

ä»¥ Pchome ç”¢å“é  `https://24h.pchome.com.tw/prod/DCAYAD-A900BIAMV` ç‚ºä¾‹ï¼ˆ[æª¢æ¸¬éç¨‹ç´€éŒ„](http://g0v.hackmd.io/5siiuEN1RAuFAI2H7l-phQ)ï¼‰

1. å…ˆæ‰“é–‹ adblock / adguardï¼ŒæŠŠä¸å¿…è¦çš„å…ƒç´ éƒ½é å…ˆæ“‹æ‰
2. æ‰“é–‹ç€è¦½å™¨é–‹ç™¼å·¥å…·ï¼Œåœç”¨å¿«å–ï¼Œè¼‰å…¥é é¢
3. åˆ‡åˆ° networkï¼Œç”¨ HAR æª”å­˜ä¸‹[å®Œæ•´çš„ request ç´€éŒ„](https://gist.github.com/irvin/8d7527636528fcb64ce2dc6b63679da3)
4. è³‡æ–™æ¸…ç†
    > - vscode æœç´¢ HAR `"url": "(.*)"` æŠ“å‡ºæ‰€æœ‰çš„ requests
    > - æŒ‰ç…§ hostname æ’åºï¼ŒåŒä¸€å€‹ sub-domain åªç•™ä¸€æ¢ 
    - å¯ç›´æ¥ä¸Ÿæ‰çš„ requests å€‘

        > å¯åƒè€ƒæ“‹å»£å‘Šè»Ÿé«”çš„æ•ˆæœï¼ˆä¾‹ï¼šå‡è¨­è¢« ublock é˜»æ“‹ï¼‰å°±å¯ä»¥ç›´æ¥ä¸Ÿæ£„
        
        - analytics:
            - `analytics.google.com`
            - `play.google.com/log`
            - `www.google-analytics.com`
        - fb: 
            - `connect.facebook.net`
            - `www.facebook.com`
        - å­—é«”:
            - `fonts.gstatic.com`
        - ad:
            - `*.doubleclick.net`
            - `www.google.com.tw/ads`
            - `*.scupio.com`
            - `jscdn.appier.net`
        - å…¶ä»–:
            - `www.youtube.com/embed/*`
5. æª¢è¦– HAR entries ä¸‹çš„æ¯ä¸€å€‹ request é …ç›®æ˜¯å¦æœ‰å¢ƒå…§å¯ç”¨æ€§
    > ä»¥[ç¬¬ä¸€é …](https://gist.github.com/irvin/8d7527636528fcb64ce2dc6b63679da3#file-24h-pchome-com-tw_archive-24-02-24-15-39-25-har-L29) `https://24h.pchome.com.tw/prod/DCAYAD-A900BIAMV` ç‚ºä¾‹

    a. ç¢ºèªè©²è³‡æºè³‡è¨Š
        
        âœ  ~ ipinfo 24h.pchome.com.tw
        Core
        - IP           34.149.253.14
        - Anycast      true
        - Hostname     14.253.149.34.bc.googleusercontent.com
        - City         Kansas City
        - Region       Missouri
        - Country      United States (US)
        - Currency     USD ($)
        - Location     39.0997,-94.5786
        - Organization AS396982 Google LLC
        - Postal       64106
        - Timezone     America/Chicago
            
    b. æª¢è¦– Anycast / åœ°ç†ä½ç½®ç‹€æ…‹

    b-1. å‡è¨­ç„¡ Anycastï¼Œå‰‡åƒè€ƒè©² ip çš„åœ°ç†ä½ç½®ï¼Œç´€éŒ„åˆ°è¡¨æ ¼ä¸Šã€‚å¦‚ä½ç½®åœ¨å³¶å…§ï¼Œå‰‡åœ¨ã€Œæ˜¯å¦å¯åŠã€å…§æ‰“ Oï¼Œåœ¨å³¶å¤–å‰‡æ‰“ Xã€‚
    
    b-2. å‡è¨­æœ‰ Anycastï¼Œå¦‚æœè©²åœ°ç†ä½ç½®ä¸åœ¨å³¶å…§ï¼Œå¯æª¢æŸ¥ã€Œè©²æœå‹™æ˜¯å¦æ˜¯å·²çŸ¥æœ‰å°ç£ç¯€é»è€…ã€ï¼Œå¦‚ä¸Šè¿°ç¯„ä¾‹ hostname ç‚ºGCPï¼Œå°ç…§ [é›²ç«¯å¹³å°--IaaS](https://g0v.hackmd.io/lmNxS58KQOm5Rf-H4SbvSw#é›²ç«¯å¹³å°--IaaS)ï¼Œç¢ºèªå…¶æœ‰å°ç£ç¯€é»ï¼Œå‰‡åœ¨ã€Œæ˜¯å¦å¯åŠã€å…§ç´€éŒ„ `-`
        
    c. æœ€çµ‚ä»¥ `X` èˆ‡ `-` çš„æ•¸å­—è©•ä¼°è©²ç¶²é çš„è€å—åº¦ã€‚ä»¥ [pchome ç”¢å“é ](https://g0v.hackmd.io/5siiuEN1RAuFAI2H7l-phQ) ç‚ºä¾‹ï¼Œå…± 7 å€‹ `O` ä½æ–¼å¢ƒå…§ã€10 å€‹ `-` ä½¿ç”¨é›²ç«¯æœå‹™å¯èƒ½æœ‰è€å—æ€§ï¼Œæ²’æœ‰ä»»ä½• `X` éé›²ç«¯çš„å¢ƒå¤–ç¯€é»ã€‚

## d) è‡ªå‹•åŒ–æª¢æ¸¬å·¥å…·

https://github.com/irvin/digital-service-resilience

### å®‰è£æ­¥é©Ÿ
```bash
git clone https://github.com/irvin/digital-service-resilience.git
cd digital-service-resilience
npm install
```

### ï¼ˆoptionalï¼‰è¨­å®š IPinfo Token
```bash
export IPINFO_TOKEN=your_token_here  # Linux/Mac
set IPINFO_TOKEN=your_token_here     # Windows CMD
$env:IPINFO_TOKEN="your_token_here"  # Windows PowerShell
```

### ä½¿ç”¨æ–¹å¼

#### åŸºæœ¬ç”¨æ³•
```bash
npm run check https://example.com
# æˆ–
node no-global-connection-check.js https://example.com
```

#### é€²éšé¸é …

**ä½¿ç”¨è‡ªè¨‚ DNS ä¼ºæœå™¨**
```bash
node no-global-connection-check.js --dns 8.8.8.8 https://example.com
```

**å„²å­˜æª¢æ¸¬çµæœ**
```bash
node no-global-connection-check.js --save https://example.com
```

**æŒ‡å®š IPinfo Token**
```bash
node no-global-connection-check.js --ipinfo-token your_token https://example.com
```

**Adblock æ¸…å–®é¸é …**

å·¥å…·é è¨­æœƒè‡ªå‹•è¼‰å…¥ [EasyList](https://easylist.to/easylist/easylist.txt) å’Œ [EasyPrivacy](https://easylist.to/easylist/easyprivacy.txt) æ¸…å–®ï¼Œç”¨æ–¼éæ¿¾å»£å‘Šå’Œè¿½è¹¤ç›¸é—œçš„ç¶²åŸŸã€‚

- **ä½¿ç”¨é è¨­ adblock æ¸…å–®**ï¼ˆé è¨­è¡Œç‚ºï¼‰ï¼š
```bash
node no-global-connection-check.js https://example.com
```

- **ä¸ä½¿ç”¨ adblock æ¸…å–®**ï¼š
```bash
node no-global-connection-check.js --no-adblock https://example.com
```

- **ä½¿ç”¨è‡ªè¨‚ adblock æ¸…å–®**ï¼š
```bash
node no-global-connection-check.js --adblock-url https://filter.futa.gg/hosts_abp.txt https://example.com
```

- **ä½¿ç”¨å¤šå€‹è‡ªè¨‚æ¸…å–®**ï¼ˆç”¨é€—è™Ÿåˆ†éš”ï¼‰ï¼š
```bash
node no-global-connection-check.js --adblock-url https://filter.futa.gg/hosts_abp.txt,https://filter.futa.gg/nofarm_abp.txt https://example.com
```

- **é–‹å•Ÿ debug æ¨¡å¼**ï¼ˆé¡¯ç¤ºè©³ç´°è³‡è¨Šï¼‰ï¼š
```bash
node no-global-connection-check.js --debug https://example.com
```

Debug æ¨¡å¼æœƒé¡¯ç¤ºï¼š
- æ‰€æœ‰æ”¶é›†åˆ°çš„è«‹æ±‚åˆ—è¡¨
- æ¸…ç†å¾Œçš„åŸŸååˆ—è¡¨
- è¢«å¿½ç•¥çš„åŸŸååˆ—è¡¨
- æ¯å€‹åŸŸåçš„ IP æª¢æŸ¥éç¨‹
- Adblock æ¸…å–®è¼‰å…¥è³‡è¨Š
- éŒ¯èª¤å †ç–Šè³‡è¨Šï¼ˆç™¼ç”ŸéŒ¯èª¤æ™‚ï¼‰

- **ä¸ä½¿ç”¨å¿«å–**ï¼ˆå¼·åˆ¶é‡æ–°ä¸‹è¼‰ adblock æ¸…å–®å’Œ IPinfo è³‡æ–™ï¼‰ï¼š
```bash
node no-global-connection-check.js --no-cache https://example.com
```

### æ‰¹æ¬¡æ¸¬è©¦

ä½¿ç”¨ `batch-test.js` å¯ä»¥æ‰¹æ¬¡æ¸¬è©¦å¤šå€‹ç¶²ç«™ã€‚æ¸¬è©¦æ¸…å–®å¿…é ˆæ˜¯ JSON æ ¼å¼ï¼ŒåŒ…å« `website`ã€`url` å’Œ `rank` æ¬„ä½ã€‚

#### åŸºæœ¬ç”¨æ³•
```bash
node batch-test.js --limit 10 top-traffic-list-taiwan/merged_lists_tw.json
```

æ¸¬è©¦æ¸…å–®æª”æ¡ˆè·¯å¾‘å¿…é ˆæ”¾åœ¨å‘½ä»¤åˆ—çš„æœ€å¾Œä¸€å€‹åƒæ•¸ã€‚

#### æ‰¹æ¬¡æ¸¬è©¦é¸é …

- **æŒ‡å®šæ¸¬è©¦æ•¸é‡**ï¼š
```bash
node batch-test.js --limit 50 top-traffic-list-taiwan/merged_lists_tw.json
```

- **å¾æŒ‡å®šä½ç½®é–‹å§‹æ¸¬è©¦**ï¼š
```bash
node batch-test.js --limit 50 --start-from 10 top-traffic-list-taiwan/merged_lists_tw.json
```

- **è¨­å®šè«‹æ±‚å»¶é²**ï¼ˆå–®ä½ï¼šæ¯«ç§’ï¼‰ï¼š
```bash
node batch-test.js --delay 3000 --limit 10 top-traffic-list-taiwan/merged_lists_tw.json
```

- **çµ„åˆä½¿ç”¨å¤šå€‹åƒæ•¸èˆ‡åŸå§‹æ¸¬è©¦æ”¯æ´çš„åƒæ•¸ **ï¼š
```bash
node batch-test.js --debug --adblock-url https://filter.futa.gg/hosts_abp.txt --limit 10 --delay 2000 top-traffic-list-taiwan/merged_lists_tw.json
```

#### æ‰¹æ¬¡æ¸¬è©¦çµæœ

æ‰¹æ¬¡æ¸¬è©¦æœƒï¼š
1. ç‚ºæ¯å€‹ç¶²ç«™ç”¢ç”Ÿç¨ç«‹çš„æª¢æ¸¬çµæœæª”æ¡ˆï¼Œå„²å­˜åœ¨ `test_results/` ç›®éŒ„
2. åœ¨æ ¹ç›®éŒ„ç”¢ç”Ÿç¸½çµå ±å‘Š `batch_summary_<timestamp>.json`ï¼ŒåŒ…å«ï¼š
   - æ¸¬è©¦åƒæ•¸
   - çµ±è¨ˆè³‡è¨Šï¼ˆç¸½æ•¸ã€æˆåŠŸã€å¤±æ•—ã€è·³éï¼‰
   - æ‰€æœ‰æ¸¬è©¦çµæœæ‘˜è¦

#### æ¸¬è©¦æ¸…å–®æ ¼å¼

æ¸¬è©¦æ¸…å–® JSON æª”æ¡ˆæ ¼å¼å¦‚ä¸‹ï¼š
```json
[
  {
    "website": "example.com",
    "url": "https://example.com",
    "rank": 1
  },
  {
    "website": "another.com",
    "url": "https://another.com",
    "rank": 2
  }
]
```

### æª¢æ¸¬çµæœèªªæ˜
- Oï¼šæœå‹™ä½æ–¼å°ç£å¢ƒå…§
- ?ï¼šä½¿ç”¨å…·æœ‰å°ç£ç¯€é»çš„é›²ç«¯æœå‹™ï¼ˆå¦‚ Google Cloudã€AWS ç­‰ï¼‰
- Xï¼šä½æ–¼å¢ƒå¤–ä¸”éé›²ç«¯æœå‹™

### ç¯„ä¾‹è¼¸å‡º
```
é–‹å§‹æª¢æ¸¬ç¶²ç«™: https://example.com
æ”¶é›†åˆ° X å€‹è«‹æ±‚
æ¸…ç†å¾Œå‰©é¤˜ Y å€‹å”¯ä¸€åŸŸå

æª¢æ¸¬çµæœ:
-------------------
å¢ƒå…§æœå‹™ (O): 3
é›²ç«¯æœå‹™ (?): 5
å¢ƒå¤–æœå‹™ (X): 1

è©³ç´°è³‡è¨Š:
example.com: O (TW (HiNet))
cdn.example.com: - (US (GOOGLE))
api.example.com: X (US (Amazon))
```


## ğŸ“œ æˆæ¬Š

This project is licensed under the CC BY-NC-ND 4.0 International. See the [LICENSE](/LICENSE) file for details.

## ğŸ™ è‡´è¬

This work was supported by a grant from the APNIC Foundation, via the Information Society Innovation Fund (ISIF Asia).