# 開發進度報告

**期間：** 2024年12月1日 至 2026年1月29日  
**報告日期：** 2026年1月29日  
**分析方法：** 基於 Git commit history + Git Diff 實際程式碼變更分析

---

## 📊 專案總覽

本專案包含五個相關的 Git repositories，共同構成「民生數位服務韌性檢測」系統：

| Repository | Commits | 程式碼變更 | 說明 |
|-----------|---------|-----------|------|
| **web-resilience-test** | 136 | **+3,546 / -320 行** | 核心檢測工具 |
| **web-resilience-test-profile** | 71 | **+2,423 / -251 行** | 靜態網站生成器 |
| **test-results** | 31 | **新增 200+ 測試結果** | 測試結果資料庫 |
| **top-traffic-list-taiwan** | 17 | **+23,122 / -6,810 行** | 台灣網站流量排名工具 |
| **resilience.ocf.tw** | 9 | **9 commits** | 部署網站 |

**總計：** 264 commits  
**程式碼變更總計：** +29,091 / -7,381 行（淨增加 21,710 行）

> **注意：** 本報告基於實際程式碼變更（Git Diff）分析，不僅依賴 commit 訊息，更能反映實際的開發工作內容。

---

## 1. web-resilience-test（核心檢測工具）

**Repository：** `/Users/Irvin/Coding/smc git/web-resilience-test`  
**Commits：** 136  
**程式碼變更：** +3,546 行 / -320 行  
**說明：** 民生數位服務韌性檢測的核心工具，用於自動化檢測網站在海纜斷掉時的韌性狀態。

### 程式碼變更分析

#### 1.1 no-global-connection-check.js（核心檢測邏輯）

**變更規模：** 從 ~100 行擴展至 ~750 行（+650 行）

**主要功能擴展：**

**A. Adblock 清單整合**
- 新增動態載入 adblock 清單功能（支援多個來源）
- 實作 adblock 規則解析器（支援 `||domain.com^` 格式）
- 新增快取機制（24 小時快取，使用 MD5 hash 檔名）
- 預設使用 Adguard DNS Filter 清單

**B. 雲端服務商判斷邏輯**
- 從靜態列表改為動態載入 `cloud_providers_tw.json`
- 建立雲端服務商索引（ASN Map、Org Keyword Map）
- 新增 Header 檢查機制（`cf-ray`、`x-amz-cf-pop`、`x-served-by`）
- 新增 RTT（Round-Trip Time）測試機制（閾值 15ms）
- 改進雲端服務商匹配邏輯（支援 ASN 和組織關鍵字匹配）

**C. 錯誤處理與重試機制**
- 新增多層次重試策略：
  1. Headless 模式測試
  2. Headless 模式 + www 前綴
  3. 非 Headless 模式
  4. 非 Headless 模式 + www 前綴
- 改進錯誤分類（測試錯誤 vs 一般失敗）
- 新增 User Agent 設定以降低錯誤率
- 支援從非 www 版本重新檢查

**D. IPinfo 快取機制**
- 實作 IPinfo API 結果快取
- 使用 MD5 hash 作為快取檔名
- 快取目錄結構化（`.cache/ipinfo/`）
- 預設 24 小時快取有效期

**E. 連線分類改進**
- 新增 `domestic/cloud`、`domestic/direct`、`foreign/cloud`、`foreign/direct` 分類
- 改進連線位置判斷邏輯
- 新增 `blob:` 連線過濾

**F. 測試結果格式**
- 新增 `test_results` 物件結構
- 新增 `domainDetails` 陣列（包含每個網域的詳細資訊）
- 新增 `testingEnvironment` 資訊
- 新增 `testParameters` 記錄

#### 1.2 batch-test.js（批次測試系統）

**新增檔案：** 533 行

**核心功能：**

**A. 批次測試架構**
- 支援並發測試（預設 4 個並發）
- 支援限制測試數量（`--limit`）
- 支援從指定位置開始測試（`--start-from`）
- 支援請求延遲設定（`--delay`）

**B. 錯誤處理**
- 支援讀取先前錯誤日誌進行重新測試
- 自動移除成功測試的舊錯誤日誌
- 錯誤日誌結構化（`_error/` 目錄）
- 批次摘要報告生成

**C. 測試結果分類**
- 自動將測試結果分類為：
  - `domestic/cloud`：境內雲端服務
  - `domestic/direct`：境內直接連線
  - `foreign/cloud`：境外雲端服務
  - `foreign/direct`：境外直接連線

**D. 參數傳遞**
- 支援所有單一測試的參數
- 命令列參數格式化顯示
- 支援自訂 DNS、IPinfo Token、Adblock 清單等

**E. 統計資料生成**
- 批次測試後自動執行 `generate_statistic.js`
- 生成 `statistic.tsv` 統計檔案

#### 1.3 generate_statistic.js（統計資料生成）

**新增檔案：** 171 行

**功能說明：**

**A. 資料讀取與處理**
- 讀取 `test-results/` 目錄下所有 JSON 檔案
- 解析測試結果資料
- 計算各類別統計（境內/境外、雲端/直連）

**B. 排序邏輯**
- 優先按照 `merged_lists_tw.json` 的順序排序
- 不在清單中的網站附加在最後
- 支援 URL 正規化（移除 protocol、trailing slash、www. 前綴）

**C. 輸出格式**
- 生成 TSV 格式統計檔案
- 包含欄位：
  - `url`、`timestamp`
  - `results_domestic_cloud`、`results_domestic_direct`
  - `results_foreign_cloud`、`results_foreign_direct`
  - `total_domestic`、`total_foreign`、`total_cloud`、`total_direct`
  - `resilience`（1 = 有韌性，0 = 無韌性）

#### 1.4 asn_taiwan_ratio.js（ASN 分析工具）

**新增檔案：** 299 行

**功能說明：**

**A. ASN 統計**
- 統計目標 ASN 的請求數和網站數
- 計算台灣請求比例
- 支援的 ASN：
  - Google LLC（AS15169, AS396982, AS19527）
  - Cloudflare（AS13335, AS209242）
  - Amazon（AS16509, AS14618）
  - Fastly（AS54113）
  - Akamai（AS20940, AS16625, AS32787）
  - Microsoft（AS8075）

**B. 韌性網站分析**
- 統計 `resilience=1` 網站使用公有雲的情況
- 分析哪些韌性網站依賴公有雲台灣節點
- 按公司名稱分組統計

**C. 輸出格式**
- 生成 `asn_taiwan_ratio.tsv` 統計檔案
- 包含欄位：
  - ASN、Company Name
  - Total Requests、Taiwan Requests、Non-Taiwan Requests
  - Taiwan Ratio (%)
  - Total Websites、Websites (domestic node)、Websites (foreign node)

#### 1.5 其他新增檔案

- **manual_curated_list_tw.json**：手動維護的測試網站清單
- **remove-duplicate-errors.js**：移除重複錯誤日誌的工具
- **as-org-frequency-stats.js**：ASN/組織頻率統計
- **cloud_strategy.md**：雲端策略文件
- **result_revisit_plan.md**：測試結果重訪計畫

### 主要功能發展時間軸

#### 2024年12月（基礎功能建立）

**2024-12-04**
- ✅ 新增批次測試功能（`batch-test.js`）
- ✅ 整合台灣網站流量排名清單（`top-traffic-list-taiwan`）
- ✅ 採用 adblock 清單過濾網域
- ✅ 實作快取機制（adblock 清單、IPinfo 結果）
- ✅ 新增 debug 模式
- ✅ 錯誤處理改進：
  - 支援 `*` 在可忽略網域清單中
  - 當頁面返回 404 時嘗試加上 `www.` 前綴
  - DNS 解析錯誤時重試 `www.*` 版本
  - 防止使用 canonical 作為檔名（測試頂層網域時）
  - 將 4xx 狀態碼視為錯誤
  - 如果重定向到 Cloudflare challenge 則拋出錯誤
- ✅ 批次測試優化：
  - 並發測試（concurrency=4）
  - 將批次摘要、錯誤日誌、測試錯誤 JSON 放入子資料夾
- ✅ 頁面載入優化：
  - 預設載入 timeout 從 30 秒延長至 120 秒
  - 使用 `page.on('load')` 而非 `networkidle` 以修復某些 timeout 問題
- ✅ 新增 README 說明 APNIC ISIF 補助資訊

**2024-12-05**
- ✅ 更新 test_results submodule 引用

#### 2025年1月（功能擴展與優化）

**2025-01-05**
- ✅ 測試結果分類功能：
  - 將測試結果分類為「國內/國外 × 雲端/直連」
- ✅ 新增雲端服務商資料（`cloud_providers_tw.json`）
- ✅ 更新 top_traffic_list submodule
- ✅ 臨時授權變更為 CC BY-NC-ND 4.0（ISIF 研究專案期間）
- ✅ 新增 TODO 與測試重訪計畫

**2025-01-06**
- ✅ 新增 `top-traffic-list-taiwan` submodule
- ✅ 批次測試功能增強：
  - 支援讀取先前錯誤日誌進行重新測試
  - 支援測試結果分類
  - 檢查無效參數
  - 記錄 console 參數
- ✅ 測試成功時移除舊錯誤日誌
- ✅ 更新測試清單（20260106）

**2025-01-07**
- ✅ 新增手動維護的測試網站清單（`manual_curated_list_tw.json`）
- ✅ 新增統計資料生成腳本（`generate_statistic.js`）
- ✅ 錯誤重試機制改進：
  - 測試錯誤時重試非 headless 模式
  - 非 www 版本發生任何錯誤時嘗試 www 版本

**2025-01-08**
- ✅ 批次測試後自動生成統計資料
- ✅ 連線檢查改進：
  - 收集更多請求（包含頁面本身）
  - 簡化錯誤日誌
  - 澄清 `net:` 錯誤訊息

**2025-01-13**
- ✅ 更新測試清單（20260108）
- ✅ 更新 TODO

**2025-01-14**
- ✅ 新增 ASN 台灣比例計算腳本（`asn_taiwan_ratio.js`）
- ✅ ASN 統計：計算公有雲網站數量
- ✅ 統計生成改進：
  - 修復 www. 網站的排序
  - 根據 merged_list 的網站排名排序統計結果
- ✅ 連線檢查改進：
  - 新增 user agent 以降低錯誤率
  - 檢查 header 和 RTT 以判斷雲端位置
  - 非 headless 模式下從非 www 版本重新檢查
- ✅ 如果存在成功日誌則移除虛擬錯誤日誌

**2025-01-15**
- ✅ 將 ASN 統計功能移至主 repo（從 top-traffic-list repo 移入）
- ✅ 修復公有雲網站在台灣 PoP 的判斷
- ✅ 統計功能增強：
  - 新增總計：雲端/直連、國內/國外
- ✅ 更新測試結果 repo
- ✅ 更新測試結果統計
- ✅ 更新 top-traffic-list repo

**2025-01-22**
- ✅ 更新 TODO

**2025-01-23**
- ✅ 重新命名 submodule：`test_results` → `test-results`
- ✅ 過濾掉 `blob:` 連線

**2025-01-24**
- ✅ README 更新：移除舊結果表格，改為連結到 resilience.ocf.tw
- ✅ 新增 article19 到手動清單
- ✅ README：新增單一網站測試程序說明

### 技術改進重點

1. **批次測試系統**
   - 支援並發測試（4 個並發）
   - 自動重試機制
   - 錯誤日誌管理
   - 測試結果分類

2. **資料處理**
   - Adblock 清單整合
   - IPinfo 快取機制
   - 統計資料自動生成
   - ASN 分析功能

3. **錯誤處理與穩定性**
   - 多種錯誤重試策略
   - 詳細的錯誤日誌
   - Debug 模式
   - 超時處理改進

---

## 2. web-resilience-test-profile（靜態網站生成器）

**Repository：** `/Users/Irvin/Coding/smc git/web-resilience-test-profile`  
**Commits：** 71  
**程式碼變更：** +2,423 行 / -251 行  
**說明：** 靜態網站生成器，用於生成「海纜斷掉時網站會動嗎？」的測試結果頁面。

### 程式碼變更分析

#### 2.1 架構重構（Handlebars → Vue.js）

**變更規模：** HTML 從 276 行重構為 181 行（精簡 95 行）

**A. 前端框架遷移**
- **移除：** Handlebars.js（`handlebars.min.js`）
- **新增：** Vue.js 3（`vue.global.prod.js`）

**B. 資源分離**
- **新增檔案：**
  - `app.js`：739 行（Vue 應用邏輯）
  - `styles.css`：463 行（樣式定義）
- **移除：** 內嵌在 HTML 中的 `<style>` 和 `<script>` 標籤

#### 2.2 app.js（Vue 應用邏輯）

**新增檔案：** 739 行

**核心功能：**

**A. 資料載入與快取**
- 從 GitHub Raw API 載入測試結果
- 實作 LocalStorage 快取機制（24 小時過期）
- 載入 `statistic.tsv` 取得所有測試網址清單
- 支援快取過期檢查與清除

**B. URL 處理**
- 統一的 URL 清理函數（`cleanUrl`）
- 支援多種清理模式：
  - `cleanUrlForDisplay`：移除協議、www、結尾斜線
  - `cleanUrlForNavigation`：移除協議、結尾斜線，保留 www
  - `cleanUrlForSearch`：移除協議，轉小寫
- URL 轉檔名功能（`urlToFilename`）

**C. 搜尋功能**
- 實作網站下拉搜尋框
- 支援即時搜尋過濾
- 搜尋結果高亮顯示
- 鍵盤導航支援（上下鍵選擇、Enter 確認）
- 搜尋時自動隱藏「檢查其他網站」按鈕

**D. 結果顯示**
- 動態顯示測試結果摘要
- 連線資訊摺疊顯示（預設摺疊）
- 根據類別可用性動態顯示內容
- 連線資訊按組織名稱排序
- 支援零分數區塊灰色顯示

**E. 靜態頁面支援**
- 檢查是否為靜態頁面（`isStaticPage()`）
- 統一使用 `/web/{domain}/` 路徑格式
- 支援從 URL 參數讀取要顯示的網址

#### 2.3 styles.css（樣式定義）

**新增檔案：** 463 行

**主要樣式：**
- 響應式設計（支援行動裝置）
- 彈性佈局（Flexbox）
- 改進分數顯示（大號數字）
- 連線資訊列表樣式
- 搜尋框樣式與動畫
- 摺疊/展開動畫效果
- 類別標籤（境內/境外、雲端/直連）

#### 2.4 建置系統（scripts/build.js）

**新增檔案：** 474 行

**核心功能：**

**A. 建置模式**
- **測試模式**：只處理第一個 URL（預設）
- **全部建置**：`--all` 參數，處理所有網站
- **單一網站**：直接傳入網站名稱（例如：`npm run build www.article19.org`）

**B. 建置流程**
1. 讀取 `statistic.tsv` 取得所有測試網址
2. 啟動本地 HTTP 伺服器（Port 3000）
3. 使用 Playwright 開啟 8 個並行瀏覽器實例
4. 每個網址透過 headless browser 載入並渲染
5. 等待 Vue 應用完全渲染
6. 取得渲染後的完整 HTML
7. 更新 meta 標籤（title、og:title、og:description、canonical）
8. 修復資源檔案路徑（相對路徑改為 `../`）
9. 生成靜態 HTML 到 `web/{domain}/index.html`

**C. 路徑處理**
- URL 轉目錄路徑（移除特殊字元，限制長度）
- 資源檔案路徑修復（`src` 和 `href` 屬性）
- 支援子目錄中的頁面正確載入資源

**D. SEO 優化**
- 動態更新頁面標題
- 更新 Open Graph 標籤
- 設定正確的 canonical URL
- 確保搜尋引擎可直接索引渲染後的內容

#### 2.5 部署系統

**新增檔案：**
- `scripts/build-worktree.js`：171 行（Worktree 管理）
- `scripts/deploy.js`：63 行（部署腳本）
- `scripts/clean-worktree.js`：26 行（清理腳本）
- `scripts/build-wrapper.js`：33 行（建置包裝腳本）

**功能說明：**

**A. Git Worktree 管理**
- 自動建立 `gh-pages` 分支的 worktree
- 將建置產物部署到 worktree
- 支援新 clone 或乾淨 repo 的 worktree 初始化

**B. 部署流程**
- `npm run build`：執行建置並準備部署
- `npm run deploy`：推送到遠端 `gh-pages` 分支
- `npm run build-worktree`：手動執行 worktree 操作

**C. 404 頁面**
- 建置時自動複製 `index.html` 作為 `404.html`
- 確保 GitHub Pages 的 404 處理正確

#### 2.6 其他改進

**A. Submodule 整合**
- 新增 `test-result` submodule（測試結果資料）
- 新增 `top-traffic-list-taiwan` submodule（雲端服務商 ASN 清單）

**B. 配置檔案**
- 更新 `package.json`（新增建置與部署腳本）
- 更新 `.gitignore`（新增 `/dist`、`/gh-pages-worktree`）
- 更新 `.gitmodules`（submodule 配置）

**C. Logo 與授權**
- 替換為 OCF Logo（`Logo_Compact-OCF_Purple.svg`）
- 新增 APNIC ISIF Logo
- 更新授權資訊

### 主要功能發展時間軸

#### 2025年2月（初始版本）

**2025-02-23**
- ✅ 建立專案基礎結構
- ✅ 新增基本 HTML 顯示測試結果
- ✅ 新增 CC0 授權
- ✅ 新增結論顯示功能
- ✅ 新增研究方法連結
- ✅ 新增 g0v digiresithon 連結
- ✅ 簡化結果顯示
- ✅ UX 微調

**2025-02-24**
- ✅ 應用模板引擎
- ✅ 變更 repo 名稱
- ✅ 微調 canonical URL
- ✅ 微調樣式，新增 g0v logo
- ✅ 修復 og:url 缺少參數
- ✅ 修復 API URL
- ✅ 修復標題連結
- ✅ 修復帶參數的 URL

#### 2026年1月（重大重構與功能擴展）

**2026-01-20**
- ✅ 修復與新測試結果 JSON 格式的相容性
- ✅ 更新預設網站與 repo 連結

**2026-01-21**
- ✅ 遷移至 Vue 模板
- ✅ 新增網站下拉搜尋框
- ✅ 新增更多測試 JSON 資訊
- ✅ 改進視覺效果
- ✅ 摺疊並改進 JSON 原始顯示
- ✅ 隱藏 www. 前綴
- ✅ 搜尋時隱藏「檢查其他網站」按鈕
- ✅ 灰色顯示零分數區塊
- ✅ 合併無結果行為
- ✅ 文字調整：「會動」→「可能會動」
- ✅ 新增 APNIC ISIF 和 OCF footer
- ✅ 新增授權資訊
- ✅ 新增 .gitignore

**2026-01-22**
- ✅ 新增建置腳本以建立靜態頁面
- ✅ 新增 `npm run deploy` 推送到 gh-pages
- ✅ 新增 README
- ✅ 新增 test-result submodule
- ✅ 新增 worktree 建置到 gh-pages 分支
- ✅ 建置到 `/web` 目錄以繞過線上環境路徑問題
- ✅ 建置：使用 headless browser（Playwright）
- ✅ 清理虛擬程式碼，修復檢查統計機制
- ✅ 複製編輯，替換 logo
- ✅ 建置時複製 index 作為 404 頁面
- ✅ statistic.tsv 快取過期時間設為 1 天
- ✅ 修復批次建置
- ✅ 修復建置，變更 canonical 連結為 resilience.ocf.tw
- ✅ 修復頁面標題後綴 `/` 的問題
- ✅ 修復資源檔案路徑
- ✅ 修復靜態網站上的 selectUrl
- ✅ 修復新 clone 或乾淨 repo 的 worktree
- ✅ gitignore：新增 `/dist`、`/gh-pages-worktree`
- ✅ 移動 build.js 到 scripts/
- ✅ 重做建置程序以修復靜態頁面問題
- ✅ 移除產生重複程式碼的虛擬建置程式碼
- ✅ 將資源從 HTML 分離
- ✅ 微調複製編輯
- ✅ 切換到正式 canonical URL

**2026-01-23**
- ✅ 新增單一網站建置模式（`build {site}`）
- ✅ 顯示連線資訊
- ✅ 根據類別可用性顯示上下文
- ✅ 微調 footer 樣式
- ✅ 根據組織名稱排序連線
- ✅ 將連線資訊上移並預設摺疊
- ✅ 新增 top-traffic-list-taiwan submodule（用於雲端服務商 ASN 清單）
- ✅ 更新 test-result submodule

**2026-01-24**
- ✅ 新增單一網站建置模式的 README

### 技術改進重點

1. **架構重構**
   - 從 Handlebars 遷移至 Vue.js
   - 將資源從 HTML 分離（app.js、styles.css）
   - 建立完整的建置流程

2. **建置系統**
   - 使用 Playwright headless browser 渲染
   - 支援單一網站建置模式
   - 自動部署到 gh-pages 分支
   - Worktree 管理

3. **功能增強**
   - 網站搜尋功能
   - 連線資訊顯示
   - 根據類別動態顯示內容
   - SEO 優化（canonical URL、meta tags）

---

## 3. test-results（測試結果資料庫）

**Repository：** `/Users/Irvin/Coding/smc git/web-resilience-test/test-results`  
**Commits：** 31  
**程式碼變更：** 新增 200+ 個測試結果 JSON 檔案  
**說明：** 儲存各個網站的測試結果 JSON 檔案，作為 Git submodule 供其他專案使用。

### 資料格式標準化

**測試結果格式：**
每個 JSON 檔案包含：
- `url`：測試的網址
- `timestamp`：測試時間
- `test_results`：測試結果統計
  - `domestic.cloud`、`domestic.direct`
  - `foreign.cloud`、`foreign.direct`
- `domainDetails`：每個網域的詳細資訊
- `testingEnvironment`：測試環境資訊
- `testParameters`：測試參數

**統計資料：**
- `statistic.tsv`：自動生成的統計資料檔案，包含所有測試網站的統計資訊
- `asn_taiwan_ratio.tsv`：ASN 台灣比例統計，分析各雲端服務商的台灣節點使用情況

**錯誤日誌結構：**
- 錯誤日誌存放在 `_error/` 目錄
- 格式：`{domain}.error.json`
- 包含錯誤原因和詳細資訊

### 主要活動時間軸

#### 2025年2-5月（初始資料收集）

**2025-02-23**
- ✅ 建立 README
- ✅ 新增 CC0 授權
- ✅ 批次新增測試結果
- ✅ 批次移除檔名中的時間戳記

**2025-02-24**
- ✅ 新增更多測試結果
- ✅ 新增特定網站：moda.gov.tw、moztw.org

**2025-02-25**
- ✅ 新增 www.matsu.idv.tw

**2025-02-27**
- ✅ 新增部分媒體網站

**2025-03-08**
- ✅ 新增 sitcon.org

**2025-05-28**
- ✅ 新增 coscup.org

#### 2025年12月（批次測試開始）

**2025-12-04**
- ✅ 批次測試結果（20251204）

**2025-12-05**
- ✅ 批次測試結果（20251205）

#### 2026年1月（資料整理與統計）

**2026-01-05**
- ✅ 臨時授權變更為 CC BY-NC-ND 4.0（ISIF 研究專案期間）

**2026-01-06**
- ✅ 新增統計資料
- ✅ 批次測試結果（20260106，兩次測試）
- ✅ 移除舊格式測試結果

**2026-01-07**
- ✅ 批次測試結果（20260107，針對先前錯誤網站）

**2026-01-08**
- ✅ 批次測試結果（20260108）

**2026-01-14**
- ✅ 批次測試結果（20260114）
- ✅ 根據網站排名排序統計結果
- ✅ 更新統計資料

**2026-01-15**
- ✅ 新增 ASN 統計
- ✅ 修復公有雲網站在台灣 PoP 的判斷
- ✅ 移除重複的舊測試結果

### 資料統計

- **測試網站總數：** 持續增加中
- **批次測試日期：** 2025-12-04, 2025-12-05, 2026-01-06, 2026-01-07, 2026-01-08, 2026-01-14
- **資料格式：** JSON（每個網站一個檔案）
- **統計資料：** statistic.tsv、ASN 統計

---

## 4. top-traffic-list-taiwan（台灣網站流量排名工具）

**Repository：** `/Users/Irvin/Coding/smc git/web-resilience-test/top-traffic-list-taiwan`  
**Commits：** 17  
**程式碼變更：** +23,122 行 / -6,810 行  
**說明：** 從多個來源抓取台灣網站流量排名清單的工具集。

### 程式碼變更分析

#### 4.1 merge-lists.js（清單合併工具）

**新增檔案：** 253 行

**功能說明：**

**A. 資料來源整合**
合併五個資料來源：
1. **Tranco List**（`tranco_list_tw.json`）
2. **Cloudflare Radar**（`cloudflare_radar_tw.json`）
3. **Ahrefs**（`ahrefs_top_tw.json`）
4. **SimilarWeb**（`similarweb_top_taiwan.json`）
5. **Semrush**（`semrush_top_tw.json`）

**B. 合併邏輯**
- 優先處理 Tranco 資料（因為有 `url` 欄位）
- 標準化網址（移除 `www.` 前綴，轉小寫）
- 保留每個來源的 rank 資訊
- 如果網址已存在，比較 rank，保留 rank 較小的
- 生成統一的 `merged_lists_tw.json` 格式

**C. 輸出格式**
```json
{
  "website": "example.com",
  "url": "https://example.com",
  "rank": {
    "tranco": 123,
    "cloudflare": 45,
    "ahrefs": 67,
    "similarweb": 23,
    "semrush": 89
  }
}
```

#### 4.2 cloud_providers_tw.json（雲端服務商資料）

**新增檔案：** 503 行

**資料結構：**

**A. 國際公有雲（有台灣節點）**
- Amazon Web Services
- Google Cloud
- Microsoft Azure
- Cloudflare
- Akamai

**B. 國際公有雲（無已知台灣節點）**
- IBM Cloud、Huawei Cloud、DigitalOcean、Fastly、Vercel

**C. 本地雲端服務商**
- 中華電信 HiCloud、遠傳電信 FETnet、台灣大哥大 Taiwan Mobile 等

**D. 識別資訊**
每個服務商包含：
- `asn`：ASN 號碼列表
- `org_keywords`：組織關鍵字列表
- `notes`：備註資訊

#### 4.3 資料更新

**排名資料更新：**
- **2026-01-06**：更新所有來源的排名資料
- Tranco List：從 ~6,000 筆擴展至 ~12,000 筆
- 其他來源資料同步更新

**清單改進：**
- 改進合併清單排名邏輯
- 新增重複檢查工具（`check-duplicates.js`）

### 主要功能發展時間軸

#### 2025年11月（資料來源整合）

**2025-11-26**
- ✅ 新增 Tranco List 抓取腳本
- ✅ 新增 Tranco .tw 結果（20251126）

**2025-11-27**
- ✅ 新增 Cloudflare Radar 台灣前 100 名抓取腳本
- ✅ 新增 Cloudflare Radar 台灣前 100 名結果（20251127）
- ✅ Tranco：切換到包含子網域的清單
- ✅ 新增 Tranco .tw 子網域結果（20251127）

**2025-11-28**
- ✅ 新增 Ahrefs 台灣前 100 名腳本與結果（20251128）
- ✅ 新增 Semrush 台灣前 100 名腳本與結果（20251128）
- ✅ 新增 SimilarWeb 台灣前 50 名腳本與結果（20251128）
- ✅ 更新 README

#### 2025年12月（清單合併功能）

**2025-12-04**
- ✅ 建立合併清單功能
- ✅ 改進合併清單排名邏輯

#### 2026年1月（功能擴展）

**2026-01-05**
- ✅ 新增常見雲端服務商 JSON（`cloud_providers_tw.json`）
- ✅ 臨時授權變更為 CC BY-NC-ND 4.0（ISIF 研究專案期間）

**2026-01-06**
- ✅ 新增 `npm run merge` 指令
- ✅ 更新 README
- ✅ 更新清單（20260106）

**2026-01-15**
- ✅ 將 ASN 統計功能移至主 repo

### 資料來源

1. **Tranco List** - 全球前 100 萬網站排名（.tw 網域）
2. **Cloudflare Radar** - Cloudflare 的台灣流量排名（前 100 名）
3. **AhrefsTop** - Ahrefs 的台灣 Organic Search 流量排名（前 100 名）
4. **SimilarWeb** - SimilarWeb 的台灣網站流量排名（前 50 名）
5. **Semrush** - Semrush 的台灣網站流量排名（前 100 名）

### 輸出檔案

- `tranco_list_tw.json`
- `cloudflare_radar_tw.json`
- `ahrefs_top_tw.json`
- `similarweb_top_taiwan.json`
- `semrush_top_tw.json`
- `merged_lists_tw.json`（合併清單）
- `cloud_providers_tw.json`（雲端服務商清單）

---

## 5. resilience.ocf.tw（部署網站）

**Repository：** `/Users/Irvin/Desktop/OCF 工作文件/resilience.ocf.tw`  
**Commits：** 9  
**說明：** GitHub Pages 部署網站，使用 submodule 引入 web-resilience-test-profile 的建置產物。

### 主要活動時間軸

**2026-01-21**
- ✅ 建立 CNAME
- ✅ 新增基本 HTML 用於測試
- ✅ 新增臨時重定向到 `/web`
- ✅ 新增 `irvin/web-resilience-test-profile` submodule

**2026-01-22**
- ✅ 更新 web（submodule 更新）

**2026-01-23**
- ✅ 更新 web（submodule 更新，4 次）

### 部署架構

- **主分支：** 包含 CNAME 和基本 HTML
- **Submodule：** `web-resilience-test-profile` 的 `gh-pages` 分支
- **部署路徑：** `/web` 目錄
- **網址：** https://resilience.ocf.tw/web/

---

## 📈 技術架構演進

### 階段一：檢測工具擴展（2024年12月 - 2025年1月）

**重點：**
- 批次測試系統建立
- Adblock 清單整合
- 快取機制實作
- 錯誤處理改進
- 測試結果分類
- 統計資料生成
- ASN 分析功能

**技術棧：**
- Node.js + Playwright
- IPinfo API
- Adblock 規則解析

### 階段二：資料收集與分析（2025年2月 - 2025年12月）

**重點：**
- 初始測試結果收集
- 流量排名資料整合
- 清單合併功能
- 雲端服務商資料庫建立

**技術棧：**
- Node.js 檔案處理
- TSV 格式輸出
- JSON 資料分析
- 多來源資料整合

### 階段三：前端重構（2025年2月 - 2026年1月中旬）

**重點：**
- 建立靜態網站生成器
- Handlebars → Vue.js 遷移
- 資源分離（CSS、JS）
- 搜尋功能實作
- 連線資訊顯示

**技術棧：**
- Vue.js 3
- LocalStorage 快取
- GitHub Raw API

### 階段四：建置與部署系統（2026年1月下旬）

**重點：**
- Playwright 建置系統
- Git Worktree 部署
- 靜態頁面生成
- SEO 優化
- 部署到 resilience.ocf.tw

**技術棧：**
- Playwright headless browser
- Git Worktree
- GitHub Pages

---

## 🎯 關鍵成果

### 1. 自動化檢測系統

- ✅ 批次測試 200+ 網站
- ✅ 自動錯誤重試機制（4 層重試策略）
- ✅ 測試結果自動分類（境內/境外 × 雲端/直連）
- ✅ 錯誤日誌管理與重新測試支援

### 2. 資料收集與分析

- ✅ 整合 5 個流量排名資料來源
- ✅ 生成統計資料（`statistic.tsv`）
- ✅ ASN 分析（`asn_taiwan_ratio.tsv`）
- ✅ 雲端服務商資料庫（`cloud_providers_tw.json`）

### 3. 使用者介面

- ✅ 完整的靜態網站（Vue.js）
- ✅ 網站搜尋功能
- ✅ 連線資訊詳細顯示
- ✅ 響應式設計

### 4. 建置與部署

- ✅ 自動化建置流程（Playwright）
- ✅ 支援單一網站建置模式
- ✅ GitHub Pages 自動部署
- ✅ SEO 優化（meta tags、canonical URL）

---

## 📝 技術棧

- **核心工具：** Node.js、Playwright
- **前端框架：** Vue.js 3（從 Handlebars 遷移）
- **建置工具：** 自訂建置腳本、Playwright headless browser
- **部署：** GitHub Pages、Git Submodules、Git Worktree
- **資料來源：** Tranco、Cloudflare Radar、Ahrefs、SimilarWeb、Semrush
- **API：** IPinfo API、GitHub Raw API
- **快取機制：** LocalStorage（前端）、檔案系統快取（後端）

## 💻 程式碼品質改進

### 1. 模組化設計
- 功能分離（檢測、建置、部署）
- 可重用的工具函數
- 清晰的檔案結構

### 2. 錯誤處理
- 多層次重試機制（4 層策略）
- 詳細的錯誤日誌
- 優雅的錯誤處理

### 3. 效能優化
- 快取機制（Adblock、IPinfo、LocalStorage）
- 並發處理（批次測試、建置）
- 資源路徑優化

### 4. 可維護性
- 清晰的程式碼註解
- 統一的命名規範
- 完整的 README 文件

### 5. 資料格式標準化
- 統一的 JSON 結構
- 標準化的欄位名稱
- TSV 格式統計資料（易於處理）
- 排序邏輯一致

---

## 🔗 相關連結

- **專案網站：** https://resilience.ocf.tw/web/
- **核心工具：** https://github.com/irvin/web-resilience-test
- **網站生成器：** https://github.com/irvin/web-resilience-test-profile
- **測試結果：** https://github.com/irvin/web-resilience-test-result
- **流量排名：** https://github.com/irvin/top-traffic-list-taiwan

---

## 📄 授權

本專案在 ISIF 研究專案期間使用 **CC BY-NC-ND 4.0 International License**。

---

**報告生成時間：** 2026年1月29日  
**資料來源：** Git commit history + Git Diff 分析（2024-12-01 至 2026-01-29）  
**分析方法：** 基於實際程式碼變更（Git Diff），不僅依賴 commit 訊息，更能反映實際的開發工作內容
